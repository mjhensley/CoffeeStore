/*! For license information please see 1f359ef7b12048a00c03.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkMsdyn365_Commerce_Online=self.webpackChunkMsdyn365_Commerce_Online||[]).push([[106],{0:t=>{t.exports=React},11:t=>{t.exports=ReactDOM},262:(t,e,i)=>{i.r(e),i.d(e,{default:()=>_});var r=i(5),n=(i(66),i(3),i(7),i(15),i(12),i(18),i(19),i(4),i(9),i(10)),a=i(17),o=i(2),s=i(166),l=i(6),c=i(1),u=i(8),d=i.n(u),p=i(13),m=i(16),h=i(0),y=i.n(h),g=i(390);async function v(t,e){const i={},r=e.cart;return r&&r.CartLines&&r.CartLines.length>0&&!e.hasInvoiceLine&&(await(0,l.getActiveCartProductsAction)(new l.ActiveCartProductsInput,t).then((t=>{t&&(i.products=t)})).catch((e=>{throw t.telemetry.exception(e),new Error("[getActiveCartWithProdcuts]Unable to hydrate cart with product information")})),await(0,l.getAvailabilitiesForCartLineItems)(new l.ProductAvailabilitiesForCartLineItems(t.requestContext.apiSettings),t).then((t=>{t&&(i.productAvailabilites=t)})).catch((e=>{throw t.telemetry.exception(e),new Error("[getActiveCartWithProdcuts]Unable to hydrate cart with product information")})),await(0,l.getDeliveryOptionsForCartLineItems)(new l.ProductDeliveryOptionsForCartLineItems(t.requestContext.apiSettings),t).then((t=>{t&&(i.deliveryOptions=t)})).catch((e=>{throw t.telemetry.exception(e),new Error("[getActiveCartWithProdcuts]Unable to hydrate cart with product information")}))),i}function C(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function b(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?C(Object(i),!0).forEach((function(e){(0,r.A)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):C(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}let f=class extends y().Component{constructor(t){super(t),this.retailMultiplePickUpOptionEnabled=!1,this.getSortedCartLines=(t,e)=>{const i=[...t];return"descending"===e?i.sort(((t,e)=>{var i,r;return(null!==(i=e.LineNumber)&&void 0!==i?i:0)-(null!==(r=t.LineNumber)&&void 0!==r?r:0)})):i.sort(((t,e)=>{var i,r;return(null!==(i=t.LineNumber)&&void 0!==i?i:0)-(null!==(r=e.LineNumber)&&void 0!==r?r:0)}))},this._getImageSettings=t=>t||{viewports:{xs:{q:"w=80&h=94&m=6",w:0,h:0},sm:{q:"w=148&h=174&m=6",w:0,h:0},lg:{q:"w=148&h=174&m=6",w:0,h:0}},lazyload:!0},this._removeItemFromCartHandler=t=>{if(this.props.data.cart.result){const e={cartLineIds:[t.LineId.toString()]};this.props.data.cart.result.removeCartLines(e).catch((t=>{this.props.telemetry.warning(t),this.props.telemetry.debug("Unable to Remove Cart Line")}))}},this.state={miniCartData:{},isCartValid:!0,isQuantityLimitsFeatureEnabled:!1},this.telemetryContent=(0,c.getTelemetryObject)(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);const e=(0,c.getPayloadObject)(o.TelemetryEvent.CheckOut,this.telemetryContent,c.TelemetryConstant.Checkout);this.checkoutBySignInAttributes=(0,c.getTelemetryAttributes)(this.telemetryContent,e),e.contentAction.etext=c.TelemetryConstant.GuestCheckout,this.checkoutByGuestAttributes=(0,c.getTelemetryAttributes)(this.telemetryContent,e),e.contentAction.etext=c.TelemetryConstant.ViewShoppingBag,this.viewShoppingBagAttributes=(0,c.getTelemetryAttributes)(this.telemetryContent,e)}async componentDidMount(){var t;const e=this.props.context.actionContext;(0,p.mJ)((()=>{var t;return null===(t=this.props.data.cart.result)||void 0===t?void 0:t.cart.CartLines}),(async()=>{this.setState({miniCartData:await v(e,this.props.data.cart.result)})})),await this._setQuantityLimitsFeatureFlag(),this.setState({orgUnitLocations:null===(t=this.props.data.orgUnitLocations)||void 0===t?void 0:t.result}),this._validateCart()}componentDidUpdate(t){this._validateCart()}shouldComponentUpdate(t,e){return this.state!==e||this.props.data!==t.data}render(){var t,e,i,r,n,s;const{id:u,typeName:p,config:{enableHoverCart:m,isAnonymousCheckout:h},context:{request:{user:{isAuthenticated:g,signInUrl:v}}},context:C,resources:f}=this.props,_=this.props.data.cart&&this.props.data.cart.result||void 0,O=(0,o.getUrlSync)("checkout",this.props.context.actionContext)||"",S=(0,o.getUrlSync)("cart",this.props.context.actionContext)||"",L=this._getCheckoutURL(g,O,v||""),w=_&&_.cart.CartLines&&0===_.cart.CartLines.length,x=(null==_?void 0:_.isProductAddedToCart)&&this.props.context.app.config.addToCartBehavior===a.AddToCartBehavior.showMiniCart,A=null==_?void 0:_.hasInvoiceLine,E=null===(t=this.props.context.request.channel)||void 0===t?void 0:t.EmailDeliveryModeCode,I=this._getCartLines(),k=(0,l.validateCartLinesInventory)(null!==(e=null==_?void 0:_.cart.CartLines)&&void 0!==e?e:[],null!==(i=this.state.miniCartData.productAvailabilites)&&void 0!==i?i:[],this.props.context.actionContext,null!==(r=this.state.miniCartData.products)&&void 0!==r?r:[],E),P=!(null!=k&&k.isValid)||!k&&!this.state.isCartValid||!!I&&I.some((t=>t.hasError)),T=this.props.data.cart&&"SUCCESS"===this.props.data.cart.status&&m,D=null!=_&&_.totalItemsInCart?_.totalItemsInCart:0,N=f.goToCartButtonTitle.replace("{count}",D.toString()),F=f.flyoutTitle,B={tag:c.UncontrolledTooltip,shouldShowMiniCart:x,placement:"bottom-end",hideArrow:!0,className:"ms-cart-icon__flyout-container",trigger:"hover",displayMode:"FLYOUT",target:u,shouldShowCloseButton:!0,cartPageUrl:S,hideAriaHidden:!0},U=_&&!_.hasInvoiceLine&&_.cart.TotalAmount||void 0,Q=U?f.totalPriceFormatString.replace("{price}",C.cultureFormatter.formatCurrency(U)):"";this.channelDeliveryOptionConfig=null===(n=this.props.data.channelDeliveryOptionConfig)||void 0===n?void 0:n.result,this.retailMultiplePickUpOptionEnabled=null===(s=this.props.data.featureState)||void 0===s||null===(s=s.result)||void 0===s||null===(s=s.find((t=>"Dynamics.AX.Application.RetailMultiplePickupDeliveryModeFeature"===t.Name)))||void 0===s?void 0:s.IsEnabled;const M=b(b({},this.props),{},{cartIcon:y().createElement(a.CartIconComponent,{cartLabel:f.cartLabel,cartQtyLabel:f.cartQtyLabel,context:C,id:u,typeName:p,data:{cart:_},telemetryContent:this.telemetryContent}),cartlines:I,FlyoutContainer:T?B:void 0,CartlinesWrapper:{className:"ms-cart-icon__cart-lines"},miniCartWrapper:{className:d()("ms-cart-icon"),id:this.props.id},miniCartItemWrapper:{className:d()("msc-cart-lines-item")},checkoutAsSignInUserButton:w||A||h&&!g?null:y().createElement(c.Button,Object.assign({disabled:P,className:"ms-cart-icon__btn-checkout",href:L,title:f.checkoutButtonTitle},this.checkoutBySignInAttributes),f.checkoutButtonTitle),checkoutAsGuestButton:!h||w||g?null:y().createElement(c.Button,Object.assign({disabled:P,className:"ms-cart-icon__btn-guestcheckout",href:O,title:f.guestCheckoutButtonTitle},this.checkoutByGuestAttributes),f.guestCheckoutButtonTitle),goToCartButton:y().createElement(c.Button,Object.assign({className:"ms-cart-icon__btn-gotocart",href:S,title:N},this.viewShoppingBagAttributes),N),checkoutBlockedDueToUnavailableFunds:null,flyoutTitle:y().createElement("span",{className:"ms-cart-icon__flyout-title"},F),totalPrice:y().createElement("div",{className:"ms-cart-icon__subtotal"},Q)});return this.props.renderView(M)}_validateCart(){var t,e;const{data:{cart:i}}=this.props,r=null!==(t=null===(e=i.result)||void 0===e||null===(e=e.cart)||void 0===e?void 0:e.Version)&&void 0!==t?t:void 0;this.lastValidatedCartVersion!==r&&(this.lastValidatedCartVersion=r,this.state.isQuantityLimitsFeatureEnabled?(0,s.HE)(i,this.props.telemetry,this.props.context).then((t=>{this.setState({isCartValid:!l.ArrayExtensions.hasElements(null==t?void 0:t.ValidationResultsPairs)})})).catch((()=>{this.setState({isCartValid:!1})})):this.setState({isCartValid:!0}))}_getCheckoutURL(t,e,i){if(t)return e;const r=(0,c.urlCheck)(e);let n=e;return o.msdyn365Commerce.isBrowser&&!r&&(n=`${window.location.origin}${e}`),`${i}${i.includes("?")?"&":"?"}ru=${n}`}_getCartLines(){var t;const{context:{request:{channel:{PickupDeliveryModeCode:e}={PickupDeliveryModeCode:void 0}}},config:i,telemetry:r,resources:n}=this.props,a=this._getImageSettings(i.imageSettings),o=this.props.data.cart&&this.props.data.cart.result;return this.state.miniCartData.products&&o&&o.cart.CartLines&&o.cart.CartLines.length>0?(0,g.O)({cartlines:this.getSortedCartLines(o.cart.CartLines,i.cartLinesSortOrder),products:this.state.miniCartData.products,productAvailabilites:this.state.miniCartData.productAvailabilites,productDeliveryOptions:this.state.miniCartData.deliveryOptions,imageSettings:a,outOfStockThreshold:this.props.context.app.config.outOfStockThreshold||0,isStockCheckEnabled:this.props.context.app.config.enableStockCheck||!1,maxCartlineQuantity:(0,c.updateMaxQuantityForCartLineItem)(this.props.context.app.config.maxQuantityForCartLineItem),gridSettings:this.props.context.request.gridSettings,context:this.props.context,typeName:this.props.typeName,id:this.props.id,resources:{sizeString:n.productDimensionTypeSize,colorString:n.productDimensionTypeColor,configString:n.productDimensionTypeConfiguration,styleString:n.productDimensionTypeStyle,quantityDisplayString:n.quantityDisplayText,salesAgreementPricePrompt:n.salesAgreementPricePrompt,inputQuantityAriaLabel:"",discountStringText:"",originalPriceText:"",currentPriceText:"",shippingChargesText:"",shippingText:n.shippingText},telemetry:r,removeButtonText:n.removeCartButtonText,outOfStockText:"",outOfRangeOneText:"",outOfRangeFormatText:"",cartState:o,orgUnitLocations:this.state.orgUnitLocations,removeItemClickHandler:this._removeItemFromCartHandler,pickupDeliveryModeCode:e,telemetryContent:this.telemetryContent,channelDeliveryOptionConfig:this.retailMultiplePickUpOptionEnabled?this.channelDeliveryOptionConfig:void 0,isQuantityLimitsFeatureEnabled:this.state.isQuantityLimitsFeatureEnabled,catalogs:null===(t=this.props.data.catalogs)||void 0===t?void 0:t.result}):null}async _setQuantityLimitsFeatureFlag(){var t,e;const i=await this.props.data.featureState,r=(null==i||null===(t=i.find((t=>"Dynamics.AX.Application.EcommerceQuantityLimitConfigurationsFeature"===t.Name)))||void 0===t?void 0:t.IsEnabled)||!1;if(r)return void this.setState({isQuantityLimitsFeatureEnabled:!0});const n=null==i||null===(e=i.find((t=>"RevertToSiteBuilderOrderQuantityLimitsSettings"===t.Name)))||void 0===e?void 0:e.IsEnabled;if(n){var a;const t=null===(a=this.props.context)||void 0===a||null===(a=a.request)||void 0===a||null===(a=a.app)||void 0===a||null===(a=a.platform)||void 0===a?void 0:a.enableDefaultOrderQuantityLimits;if(!t||"none"===t)return void this.setState({isQuantityLimitsFeatureEnabled:!1});try{var o;const t=await this.props.data.featureState,e=(null==t||null===(o=t.find((t=>"Dynamics.AX.Application.RetailDefaultOrderQuantityLimitsFeature"===t.Name)))||void 0===o?void 0:o.IsEnabled)||!1;if(!e)return void this.setState({isQuantityLimitsFeatureEnabled:!1})}catch(t){return this.props.telemetry.warning(t),this.props.telemetry.debug("Unable to get feature states"),void this.setState({isQuantityLimitsFeatureEnabled:!1})}"all"===t?this.setState({isQuantityLimitsFeatureEnabled:!0}):this.props.data.customerInformation.then((e=>{const i=!!e&&("b2b"===t&&e.IsB2b||"b2c"===t&&!e.IsB2b);this.setState({isQuantityLimitsFeatureEnabled:i})})).catch((t=>{this.props.telemetry.warning(t),this.props.telemetry.debug("Unable to get customer info")}))}else{var s;const t=await this.props.data.cartConfiguration;this.setState({isQuantityLimitsFeatureEnabled:!(null!==(s=null==t?void 0:t.IgnoreOrderSettings)&&void 0!==s&&s)})}}};f=(0,n.Cg)([m.PA],f);const _=f},390:(t,e,i)=>{i.d(e,{O:()=>h});i(3),i(9),i(22),i(23),i(21);var r=i(17),n=i(2),a=i(35),o=i(6),s=i(1),l=i(0),c=i(140);const u=(t,e)=>{let i;if(t&&t.FulfillmentStoreId){var r;const n=p(t.FulfillmentStoreId,e.orgUnitLocations);let a;e.productDeliveryOptions&&e.productDeliveryOptions.length>0&&(a=e.productDeliveryOptions.find((e=>e&&e.ProductId===t.ProductId)));const o=null===(r=a)||void 0===r||null===(r=r.DeliveryOptions)||void 0===r?void 0:r.find((e=>e.Code===t.DeliveryMode)),s=null==o?void 0:o.Description;i=s?`${s}, ${n}`:`${n}`}else i=e.resources.shippingText;return i},d=(t,e)=>{if(t&&t.FulfillmentStoreId){const i=p(t.FulfillmentStoreId,e.orgUnitLocations);if(i)return l.createElement("div",{className:"msc-cart-line__bopis-method"},l.createElement("span",{className:"pick-up"},i))}return null},p=(t,e)=>{if(!e||!t||0===e.length)return"";const i=e.find((e=>e.OrgUnitNumber===t));return i?i.OrgUnitName:t},m=(t,e,i)=>{const p=[];return e&&0!==e.length?(t.map(((t,m)=>{let h,y,g;var v;(h=i.isQuantityLimitsFeatureEnabled?(0,c.F)(t.ProductId,e,t.WarehouseId,i.cartState):(0,c.R)(t.ProductId,e),i.productAvailabilites&&i.productAvailabilites.length>0&&(y=i.productAvailabilites.find((e=>{var i;return(null===(i=e.ProductAvailableQuantity)||void 0===i?void 0:i.ProductId)===t.ProductId}))),i.productDeliveryOptions&&i.productDeliveryOptions.length>0&&(g=i.productDeliveryOptions.find((e=>e&&e.ProductId===t.ProductId))),h)&&p.push(((t,e,i,c,p,m)=>{var h;const{imageSettings:y,gridSettings:g,id:v,typeName:C,context:b,resources:f,removeButtonText:_,removeItemClickHandler:O}=i,S=(L=i.isStockCheckEnabled,w=i.outOfStockThreshold,x=p,L?!x||!x.AvailableQuantity||x.AvailableQuantity<=0||x.AvailableQuantity<=w?0:x.AvailableQuantity-w:0);var L,w,x;const A=e&&((t,e,i,r,n)=>{if(r){let r=n;return n||(r=t||10),e?r<i?r:i:r}return e&&i<t?i:t})(i.maxCartlineQuantity,i.isStockCheckEnabled,S,i.isQuantityLimitsFeatureEnabled,(null==e||null===(h=e.Behavior)||void 0===h?void 0:h.MaximumQuantity)||0),E=e.ItemTypeValue===a.ReleasedProductType.Service,I=((t,e)=>()=>{t(e)})(O,t),k=(0,s.getPayloadObject)("click",i.telemetryContent,s.TelemetryConstant.RemoveCartItem),P=(0,s.getTelemetryAttributes)(i.telemetryContent,k);let T=(0,o.getProductUrlSync)(e,i.context.actionContext,void 0);if(n.default.isBrowser&&(0,n.isChannelTypeB2B)(i.context.actionContext.requestContext)){var D;const e=new URL(T,window.location.href);e.searchParams.set("catalogid",`${null!==(D=t.CatalogId)&&void 0!==D?D:0}`),T=e.href}return{data:{product:e,cartline:t},hasError:!(E||!i.isStockCheckEnabled)&&t.Quantity>A,cartline:l.createElement(r.CartLineItemComponent,{data:{cartLine:t,product:e,catalogs:i.catalogs},currentQuantity:t.Quantity,maxQuantity:A,isOutOfStock:!(E||!i.isStockCheckEnabled)&&S<=0,gridSettings:g,imageSettings:y,id:v,typeName:C,productUrl:T,context:b,resources:f,key:`${c}-${T}`,isQuantityEditable:!1,primaryImageUrl:e.PrimaryImageUrl,displayMode:"COMPACT",telemetryContent:i.telemetryContent,channelDeliveryOptionConfig:i.channelDeliveryOptionConfig,deliveryLocation:u(t,i)}),remove:l.createElement(s.Button,Object.assign({className:"msc-cart-line__remove-item",onClick:I,title:_},P),_),storeLocation:d(t,i)}})(t,h,i,m,null===(v=y)||void 0===v?void 0:v.ProductAvailableQuantity))})),p):(i.context.telemetry.error("Cartlines content is empty, module wont render"),null)},h=t=>{const{products:e,cartlines:i}=t;return m(i,e,t)}},639:(t,e,i)=>{i.d(e,{getProductByProductId:()=>r.R,getProductByProductIdAndWarehouse:()=>r.F});i(433),i(434);var r=i(140);i(489),i(988),i(611),i(262),i(390)},1638:(t,e,i)=>{var r=i(5);i(4);function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){(0,r.A)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}const o={modules:{},dataActions:{}},s=(t,e)=>{if(o.dataActions[t]=e,!o.dataActions[t].default)throw new Error("Data action path "+t+" does not have a default export");o.dataActions[t].default.prototype.RegistrationId=t,o.dataActions[t].default.prototype.id&&(o.dataActions[o.dataActions[t].default.prototype.id]=t)};o.modules["eve-cart-icon"]={c:()=>i(1639),$type:"containerModule",da:[{name:"cart",path:"@msdyn365-commerce/global-state/dist/lib/data-actions/get-cart-state-data-action",runOn:1},{name:"cartConfiguration",path:"@msdyn365-commerce-modules/retail-actions/dist/lib/get-cart-configuration",runOn:0},{name:"catalogs",path:"@msdyn365-commerce-modules/retail-actions/dist/lib/get-catalogs",runOn:0},{name:"channelDeliveryOptionConfig",path:"@msdyn365-commerce-modules/retail-actions/dist/lib/get-channel-delivery-option-configuration",runOn:0},{name:"customerBalances",path:"@msdyn365-commerce-modules/retail-actions/dist/lib/get-customer-balance",runOn:0},{name:"customerInformation",path:"@msdyn365-commerce-modules/retail-actions/dist/lib/get-customer",runOn:0},{name:"featureState",path:"@msdyn365-commerce-modules/retail-actions/dist/lib/get-feature-state",runOn:0},{name:"orgUnitLocations",path:"@msdyn365-commerce-modules/retail-actions/dist/lib/search-org-unit-locations",runOn:0}],iNM:!1,ns:"__local__",n:"eve-cart-icon",p:"__local__",pdp:"",md:"src/modules/eve-cart-icon"};{const t="@msdyn365-commerce-modules/retail-actions/dist/lib/get-cart-configuration";let e=i(90);s(t,e)}{const t="@msdyn365-commerce-modules/retail-actions/dist/lib/get-catalogs";let e=i(76);s(t,e)}{const t="@msdyn365-commerce-modules/retail-actions/dist/lib/get-channel-delivery-option-configuration";let e=i(57);s(t,e)}{const t="@msdyn365-commerce-modules/retail-actions/dist/lib/get-customer";let e=i(24);s(t,e)}{const t="@msdyn365-commerce-modules/retail-actions/dist/lib/get-customer-balance";let e=i(113);s(t,e)}{const t="@msdyn365-commerce-modules/retail-actions/dist/lib/get-feature-state";let e=i(29);s(t,e)}{const t="@msdyn365-commerce-modules/retail-actions/dist/lib/search-org-unit-locations";let e=i(119);s(t,e)}{const t="@msdyn365-commerce/global-state/dist/lib/data-actions/get-cart-state-data-action";let e=i(163);s(t,e)}window.__bindings__=window.__bindings__||{},window.__bindings__.modules=a(a({},window.__bindings__.modules||{}),o.modules),window.__bindings__.dataActions=a(a({},window.__bindings__.dataActions||{}),o.dataActions);const l={};l["__local__|__local__|modules|eve-cart-icon|eve-cart-icon"]={c:()=>i(1640),cn:"__local__-__local__-eve-cart-icon"},window.__bindings__=window.__bindings__||{},window.__bindings__.viewDictionary=a(a({},window.__bindings__.viewDictionary||{}),l)},1639:(t,e,i)=>{i.r(e),i.d(e,{default:()=>A});var r,n=i(5),a=(i(66),i(3),i(7),i(15),i(12),i(18),i(19),i(4),i(9),i(10)),o=i(17),s=i(2),l=i(166),c=i(6),u=i(1),d=i(8),p=i.n(d),m=i(13),h=i(16),y=i(0),g=i.n(y);!function(t){t.ascending="ascending",t.descending="descending"}(r||(r={}));i(22),i(23),i(21);var v=i(35),C=i(639);const b=(t,e)=>{let i;if(t&&t.FulfillmentStoreId){var r;const n=_(t.FulfillmentStoreId,e.orgUnitLocations);let a;e.productDeliveryOptions&&e.productDeliveryOptions.length>0&&(a=e.productDeliveryOptions.find((e=>e&&e.ProductId===t.ProductId)));const o=null===(r=a)||void 0===r||null===(r=r.DeliveryOptions)||void 0===r?void 0:r.find((e=>e.Code===t.DeliveryMode)),s=null==o?void 0:o.Description;i=s?`${s}, ${n}`:`${n}`}else i=e.resources.shippingText;return i},f=(t,e)=>{if(t&&t.FulfillmentStoreId){const i=_(t.FulfillmentStoreId,e.orgUnitLocations);if(i)return y.createElement("div",{className:"msc-cart-line__bopis-method"},y.createElement("span",{className:"pick-up"},i))}return null},_=(t,e)=>{if(!e||!t||0===e.length)return"";const i=e.find((e=>e.OrgUnitNumber===t));return i?i.OrgUnitName:t},O=(t,e,i)=>{const r=[];return e&&0!==e.length?(t.map(((t,n)=>{let a,l,d;var p;(a=(i.isQuantityLimitsFeatureEnabled,(0,C.getProductByProductId)(t.ProductId,e)),i.productAvailabilites&&i.productAvailabilites.length>0&&(l=i.productAvailabilites.find((e=>{var i;return(null===(i=e.ProductAvailableQuantity)||void 0===i?void 0:i.ProductId)===t.ProductId}))),i.productDeliveryOptions&&i.productDeliveryOptions.length>0&&(d=i.productDeliveryOptions.find((e=>e&&e.ProductId===t.ProductId))),a)&&r.push(((t,e,i,r,n,a)=>{var l;const{imageSettings:d,gridSettings:p,id:m,typeName:h,context:g,resources:C,removeButtonText:_,removeItemClickHandler:O}=i,S=(L=i.isStockCheckEnabled,w=i.outOfStockThreshold,x=n,L?!x||!x.AvailableQuantity||x.AvailableQuantity<=0||x.AvailableQuantity<=w?0:x.AvailableQuantity-w:0);var L,w,x;const A=e&&((t,e,i,r,n)=>{if(r){let r=n;return n||(r=t||10),e?r<i?r:i:r}return e&&i<t?i:t})(i.maxCartlineQuantity,i.isStockCheckEnabled,S,i.isQuantityLimitsFeatureEnabled,(null==e||null===(l=e.Behavior)||void 0===l?void 0:l.MaximumQuantity)||0),E=e.ItemTypeValue===v.ReleasedProductType.Service,I=((t,e)=>()=>{t(e)})(O,t),k=(0,u.getPayloadObject)("click",i.telemetryContent,u.TelemetryConstant.RemoveCartItem),P=(0,u.getTelemetryAttributes)(i.telemetryContent,k);let T=(0,c.getProductUrlSync)(e,i.context.actionContext,void 0);if(s.default.isBrowser&&(0,s.isChannelTypeB2B)(i.context.actionContext.requestContext)){var D;const e=new URL(T,window.location.href);e.searchParams.set("catalogid",`${null!==(D=t.CatalogId)&&void 0!==D?D:0}`),T=e.href}const N=y.createElement(o.CartLineItemComponent,{data:{cartLine:t,product:e,catalogs:i.catalogs},currentQuantity:t.Quantity,maxQuantity:A,isOutOfStock:!(E||!i.isStockCheckEnabled)&&S<=0,gridSettings:p,imageSettings:d,id:m,typeName:h,productUrl:T,context:g,resources:C,key:`${r}-${T}`,isQuantityEditable:!1,primaryImageUrl:e.PrimaryImageUrl,displayMode:"COMPACT",telemetryContent:i.telemetryContent,channelDeliveryOptionConfig:i.channelDeliveryOptionConfig,deliveryLocation:b(t,i)});return console.log(N),{data:{product:e,cartline:t},hasError:!(E||!i.isStockCheckEnabled)&&t.Quantity>A,cartline:N,remove:y.createElement(u.Button,Object.assign({className:"msc-cart-line__remove-item",onClick:I,title:_},P),_),storeLocation:f(t,i)}})(t,a,i,n,null===(p=l)||void 0===p?void 0:p.ProductAvailableQuantity))})),r):(i.context.telemetry.error("Cartlines content is empty, module wont render"),null)};async function S(t,e){const i={},r=e.cart;return r&&r.CartLines&&r.CartLines.length>0&&!e.hasInvoiceLine&&(await(0,c.getActiveCartProductsAction)(new c.ActiveCartProductsInput,t).then((t=>{t&&(i.products=t)})).catch((e=>{throw t.telemetry.exception(e),new Error("[getActiveCartWithProdcuts]Unable to hydrate cart with product information")})),await(0,c.getAvailabilitiesForCartLineItems)(new c.ProductAvailabilitiesForCartLineItems(t.requestContext.apiSettings),t).then((t=>{t&&(i.productAvailabilites=t)})).catch((e=>{throw t.telemetry.exception(e),new Error("[getActiveCartWithProdcuts]Unable to hydrate cart with product information")})),await(0,c.getDeliveryOptionsForCartLineItems)(new c.ProductDeliveryOptionsForCartLineItems(t.requestContext.apiSettings),t).then((t=>{t&&(i.deliveryOptions=t)})).catch((e=>{throw t.telemetry.exception(e),new Error("[getActiveCartWithProdcuts]Unable to hydrate cart with product information")}))),i}function L(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function w(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?L(Object(i),!0).forEach((function(e){(0,n.A)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):L(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}let x=class extends g().Component{constructor(t){super(t),this.retailMultiplePickUpOptionEnabled=!1,this.getSortedCartLines=(t,e)=>{const i=[...t];return e===r.descending?i.sort(((t,e)=>{var i,r;return(null!==(i=e.LineNumber)&&void 0!==i?i:0)-(null!==(r=t.LineNumber)&&void 0!==r?r:0)})):i.sort(((t,e)=>{var i,r;return(null!==(i=t.LineNumber)&&void 0!==i?i:0)-(null!==(r=e.LineNumber)&&void 0!==r?r:0)}))},this._getImageSettings=t=>t||{viewports:{xs:{q:"w=80&h=94&m=6",w:0,h:0},sm:{q:"w=148&h=174&m=6",w:0,h:0},lg:{q:"w=148&h=174&m=6",w:0,h:0}},lazyload:!0},this._removeItemFromCartHandler=t=>{if(this.props.data.cart.result){const e={cartLineIds:[t.LineId.toString()]};this.props.data.cart.result.removeCartLines(e).catch((t=>{this.props.telemetry.warning(t),this.props.telemetry.debug("Unable to Remove Cart Line")}))}},this.state={miniCartData:{},isCartValid:!0,isQuantityLimitsFeatureEnabled:!1},this.telemetryContent=(0,u.getTelemetryObject)(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);const e=(0,u.getPayloadObject)(s.TelemetryEvent.CheckOut,this.telemetryContent,u.TelemetryConstant.Checkout);this.checkoutBySignInAttributes=(0,u.getTelemetryAttributes)(this.telemetryContent,e),e.contentAction.etext=u.TelemetryConstant.GuestCheckout,this.checkoutByGuestAttributes=(0,u.getTelemetryAttributes)(this.telemetryContent,e),e.contentAction.etext=u.TelemetryConstant.ViewShoppingBag,this.viewShoppingBagAttributes=(0,u.getTelemetryAttributes)(this.telemetryContent,e)}async componentDidMount(){var t;const e=this.props.context.actionContext;(0,m.mJ)((()=>{var t;return null===(t=this.props.data.cart.result)||void 0===t?void 0:t.cart.CartLines}),(async()=>{this.setState({miniCartData:await S(e,this.props.data.cart.result)})})),await this._setQuantityLimitsFeatureFlag(),this.setState({orgUnitLocations:null===(t=this.props.data.orgUnitLocations)||void 0===t?void 0:t.result}),this._validateCart()}componentDidUpdate(t){this._validateCart()}shouldComponentUpdate(t,e){return this.state!==e||this.props.data!==t.data}render(){var t,e,i,r,n,a;const{id:l,typeName:d,config:{enableHoverCart:m,isAnonymousCheckout:h},context:{request:{user:{isAuthenticated:y,signInUrl:v}}},context:C,resources:b}=this.props,f=this.props.data.cart&&this.props.data.cart.result||void 0,_=(0,s.getUrlSync)("checkout",this.props.context.actionContext)||"",O=(0,s.getUrlSync)("cart",this.props.context.actionContext)||"",S=this._getCheckoutURL(y,_,v||""),L=f&&f.cart.CartLines&&0===f.cart.CartLines.length,x=(null==f?void 0:f.isProductAddedToCart)&&this.props.context.app.config.addToCartBehavior===o.AddToCartBehavior.showMiniCart,A=null==f?void 0:f.hasInvoiceLine,E=null===(t=this.props.context.request.channel)||void 0===t?void 0:t.EmailDeliveryModeCode,I=this._getCartLines(),k=(0,c.validateCartLinesInventory)(null!==(e=null==f?void 0:f.cart.CartLines)&&void 0!==e?e:[],null!==(i=this.state.miniCartData.productAvailabilites)&&void 0!==i?i:[],this.props.context.actionContext,null!==(r=this.state.miniCartData.products)&&void 0!==r?r:[],E),P=!(null!=k&&k.isValid)||!k&&!this.state.isCartValid||!!I&&I.some((t=>t.hasError)),T=this.props.data.cart&&"SUCCESS"===this.props.data.cart.status&&m,D=null!=f&&f.totalItemsInCart?f.totalItemsInCart:0,N=b.goToCartButtonTitle.replace("{count}",D.toString()),F=b.flyoutTitle,B={tag:u.UncontrolledTooltip,shouldShowMiniCart:x,placement:"bottom-end",hideArrow:!0,className:"ms-cart-icon__flyout-container",trigger:"hover",displayMode:"FLYOUT",target:l,shouldShowCloseButton:!0,cartPageUrl:O,hideAriaHidden:!0},U=f&&!f.hasInvoiceLine&&f.cart.TotalAmount||void 0,Q=U?b.totalPriceFormatString.replace("{price}",C.cultureFormatter.formatCurrency(U)):"";this.channelDeliveryOptionConfig=null===(n=this.props.data.channelDeliveryOptionConfig)||void 0===n?void 0:n.result,this.retailMultiplePickUpOptionEnabled=null===(a=this.props.data.featureState)||void 0===a||null===(a=a.result)||void 0===a||null===(a=a.find((t=>"Dynamics.AX.Application.RetailMultiplePickupDeliveryModeFeature"===t.Name)))||void 0===a?void 0:a.IsEnabled;const M=w(w({},this.props),{},{cartIcon:g().createElement(o.CartIconComponent,{cartLabel:b.cartLabel,cartQtyLabel:b.cartQtyLabel,context:C,id:l,typeName:d,data:{cart:f},telemetryContent:this.telemetryContent}),cartlines:I,FlyoutContainer:T?B:void 0,CartlinesWrapper:{className:"ms-cart-icon__cart-lines"},miniCartWrapper:{className:p()("ms-cart-icon"),id:this.props.id},miniCartItemWrapper:{className:p()("msc-cart-lines-item")},checkoutAsSignInUserButton:L||A||h&&!y?null:g().createElement(u.Button,Object.assign({disabled:P,className:"ms-cart-icon__btn-checkout",href:S,title:b.checkoutButtonTitle},this.checkoutBySignInAttributes),b.checkoutButtonTitle),checkoutAsGuestButton:!h||L||y?null:g().createElement(u.Button,Object.assign({disabled:P,className:"ms-cart-icon__btn-guestcheckout",href:_,title:b.guestCheckoutButtonTitle},this.checkoutByGuestAttributes),b.guestCheckoutButtonTitle),goToCartButton:g().createElement(u.Button,Object.assign({className:"ms-cart-icon__btn-gotocart",href:O,title:N},this.viewShoppingBagAttributes),N),checkoutBlockedDueToUnavailableFunds:null,flyoutTitle:g().createElement("span",{className:"ms-cart-icon__flyout-title"},F),totalPrice:g().createElement("div",{className:"ms-cart-icon__subtotal"},Q)});return this.props.renderView(M)}_validateCart(){var t,e;const{data:{cart:i}}=this.props,r=null!==(t=null===(e=i.result)||void 0===e||null===(e=e.cart)||void 0===e?void 0:e.Version)&&void 0!==t?t:void 0;this.lastValidatedCartVersion!==r&&(this.lastValidatedCartVersion=r,this.state.isQuantityLimitsFeatureEnabled?(0,l.HE)(i,this.props.telemetry,this.props.context).then((t=>{this.setState({isCartValid:!c.ArrayExtensions.hasElements(null==t?void 0:t.ValidationResultsPairs)})})).catch((()=>{this.setState({isCartValid:!1})})):this.setState({isCartValid:!0}))}_getCheckoutURL(t,e,i){if(t)return e;const r=(0,u.urlCheck)(e);let n=e;return s.msdyn365Commerce.isBrowser&&!r&&(n=`${window.location.origin}${e}`),`${i}${i.includes("?")?"&":"?"}ru=${n}`}_getCartLines(){var t;const{context:{request:{channel:{PickupDeliveryModeCode:e}={PickupDeliveryModeCode:void 0}}},config:i,telemetry:r,resources:n}=this.props,a=this._getImageSettings(i.imageSettings),o=this.props.data.cart&&this.props.data.cart.result;return this.state.miniCartData.products&&o&&o.cart.CartLines&&o.cart.CartLines.length>0?(t=>{const{products:e,cartlines:i}=t;return O(i,e,t)})({cartlines:this.getSortedCartLines(o.cart.CartLines,i.cartLinesSortOrder),products:this.state.miniCartData.products,productAvailabilites:this.state.miniCartData.productAvailabilites,productDeliveryOptions:this.state.miniCartData.deliveryOptions,imageSettings:a,outOfStockThreshold:this.props.context.app.config.outOfStockThreshold||0,isStockCheckEnabled:this.props.context.app.config.enableStockCheck||!1,maxCartlineQuantity:(0,u.updateMaxQuantityForCartLineItem)(this.props.context.app.config.maxQuantityForCartLineItem),gridSettings:this.props.context.request.gridSettings,context:this.props.context,typeName:this.props.typeName,id:this.props.id,resources:{sizeString:n.productDimensionTypeSize,colorString:n.productDimensionTypeColor,configString:n.productDimensionTypeConfiguration,styleString:n.productDimensionTypeStyle,quantityDisplayString:n.quantityDisplayText,salesAgreementPricePrompt:n.salesAgreementPricePrompt,inputQuantityAriaLabel:"",discountStringText:"",originalPriceText:"",currentPriceText:"",shippingChargesText:"",shippingText:n.shippingText},telemetry:r,removeButtonText:n.removeCartButtonText,outOfStockText:"",outOfRangeOneText:"",outOfRangeFormatText:"",cartState:o,orgUnitLocations:this.state.orgUnitLocations,removeItemClickHandler:this._removeItemFromCartHandler,pickupDeliveryModeCode:e,telemetryContent:this.telemetryContent,channelDeliveryOptionConfig:this.retailMultiplePickUpOptionEnabled?this.channelDeliveryOptionConfig:void 0,isQuantityLimitsFeatureEnabled:this.state.isQuantityLimitsFeatureEnabled,catalogs:null===(t=this.props.data.catalogs)||void 0===t?void 0:t.result}):null}async _setQuantityLimitsFeatureFlag(){var t,e;const i=await this.props.data.featureState,r=(null==i||null===(t=i.find((t=>"Dynamics.AX.Application.EcommerceQuantityLimitConfigurationsFeature"===t.Name)))||void 0===t?void 0:t.IsEnabled)||!1;if(r)return void this.setState({isQuantityLimitsFeatureEnabled:!0});const n=null===(e=this.props.context)||void 0===e||null===(e=e.request)||void 0===e||null===(e=e.app)||void 0===e||null===(e=e.platform)||void 0===e?void 0:e.enableDefaultOrderQuantityLimits;if(n&&"none"!==n){try{var a;const t=await this.props.data.featureState,e=(null==t||null===(a=t.find((t=>"Dynamics.AX.Application.RetailDefaultOrderQuantityLimitsFeature"===t.Name)))||void 0===a?void 0:a.IsEnabled)||!1;if(!e)return void this.setState({isQuantityLimitsFeatureEnabled:!1})}catch(t){return this.props.telemetry.warning(t),this.props.telemetry.debug("Unable to get feature states"),void this.setState({isQuantityLimitsFeatureEnabled:!1})}"all"===n?this.setState({isQuantityLimitsFeatureEnabled:!0}):this.props.data.customerInformation.then((t=>{const e=!!t&&("b2b"===n&&t.IsB2b||"b2c"===n&&!t.IsB2b);this.setState({isQuantityLimitsFeatureEnabled:e})})).catch((t=>{this.props.telemetry.warning(t),this.props.telemetry.debug("Unable to get customer info")}))}else this.setState({isQuantityLimitsFeatureEnabled:!1})}};x=(0,a.Cg)([h.PA],x);const A=x},1640:(t,e,i)=>{i.r(e),i.d(e,{CartIconView:()=>d,default:()=>p});i(37),i(3),i(70),i(12);var r=i(17),n=i(2),a=i(6),o=i(1),s=i(8),l=i.n(s),c=i(0),u=i.n(c);class d extends u().PureComponent{constructor(t){super(t),this._modalContainer=()=>({tag:o.Modal,placement:"bottom-end",hideArrow:!0,className:"ms-cart-icon__minicartmodal-container",wrapClassName:"ms-cart-icon__minicartmodal",isOpen:this.state.isModalOpen,toggle:this.closeModal}),this._openModal=()=>{const t=(0,o.getPayloadObject)("click",this.props.telemetryContent,"cart-icon","");(0,o.onTelemetryClick)(this.props.telemetryContent,t,"cart-icon"),this.setState({isModalOpen:!0})},this.closeModal=()=>{this.setState({isModalOpen:!1})},this._renderCartCloseIcon=()=>u().createElement(o.Button,{className:"ms-cart-icon__btn-close","aria-label":"Close",onClick:this.closeModal}),this._renderCartItemCount=t=>{var e;let i;const r=null===(e=t.data.cart.result)||void 0===e?void 0:e.cart.CartLines;return i=a.ArrayExtensions.hasElements(r)?1===r.length?"1 product":`${r.length} products`:"0 product",u().createElement(o.Node,{className:"ms-cart-icon__count",tabIndex:"0"},i)},this._escFunction=t=>{t.keyCode===o.KeyCodes.Escape&&this.state.isModalOpen&&this.closeModal()},this.isAutoDisplayTriggered=!1,this.state={isModalOpen:!1}}componentDidMount(){n.default.isBrowser&&window.addEventListener("keydown",this._escFunction,!1)}componentWillUnmount(){n.default.isBrowser&&window.removeEventListener("keydown",this._escFunction,!1)}render(){var t,e,i,s;const c=null!==(t=this.props.data.cart.result)&&void 0!==t?t:void 0,d=(null==c?void 0:c.isProductAddedToCart)&&this.props.context.app.config.addToCartBehavior===r.AddToCartBehavior.showMiniCart;return d&&(this.isAutoDisplayTriggered?this.state.isModalOpen||(this.isAutoDisplayTriggered=!1):(this.setState({isModalOpen:!0}),this.isAutoDisplayTriggered=!0)),u().createElement(o.Node,Object.assign({},this.props.miniCartWrapper,this.props.renderModuleAttributes(this.props)),u().createElement("button",{onClick:this._openModal,className:"ms-cart-icon-wrapper msc-btn"},this.props.cartIcon),u().createElement(o.Node,Object.assign({},this._modalContainer()),u().createElement(o.Node,{className:"ms-cart-icon__header msc-modal__header"},this.props.flyoutTitle,this._renderCartItemCount(this.props),this._renderCartCloseIcon()),u().createElement(o.Node,{className:"ms-cart-icon__body msc-modal__body"},null!==(e=this.props.data.cart.result)&&void 0!==e&&e.isEmpty?this.props.slots.emptyCart:null,u().createElement(o.Node,Object.assign({},this.props.CartlinesWrapper),((t,e)=>{var i;const r=null!==(i=e.data.cart.result)&&void 0!==i?i:void 0;return null!=r&&r.hasInvoiceLine&&null!=r&&r.cart.CartLines?r.cart.CartLines.map(((t,i)=>{var r;const n=i,s=(null===(r=t.TotalAmount)||void 0===r?void 0:r.toString())||"0";return u().createElement(o.Node,Object.assign({},e.miniCartItemWrapper,{key:n}),u().createElement("div",{className:"msc-cart-line"},u().createElement("div",{className:"msc-cart-line__content"},u().createElement("div",{className:"msc-cart-line__product"},u().createElement("span",null,u().createElement("a",{className:"msc-cart-line__product-title",href:`${(0,a.getInvoiceDetailsPageUrlSync)(t.InvoiceId||"",e.context.actionContext)}`},"Invoice ",t.InvoiceId)),u().createElement("span",{className:"msc-price__actual"},"$",parseFloat(s).toFixed(2)),u().createElement("br",null),u().createElement(o.Button,{className:"msc-cart-line__remove-item",onClick:()=>((t,e)=>{if(t.data.cart.result){const i={cartLineIds:[e.LineId.toString()]};t.data.cart.result.removeCartLines(i).catch((e=>{t.telemetry.warning(e),t.telemetry.debug("Unable to Remove Cart Line")}))}})(e,t)},"Remove")))))})):t?t.map(((t,i)=>{const r=i;return u().createElement(o.Node,Object.assign({},e.miniCartItemWrapper,{key:r}),u().createElement(o.Node,{className:l()(t.storeLocation?"msc-cart-line__set-net-price":"")},t.cartline),t.remove,t.storeLocation)})):(e.context.telemetry.error("Cartlines content is empty, module wont render"),null)})(this.props.cartlines,this.props))),u().createElement(o.Node,{className:"ms-cart-icon__footer msc-modal__footer"},this.props.slots.promoContentItem,(t=>{var e;const i=null!==(e=t.data.cart.result)&&void 0!==e?e:void 0,r=i&&(i.cart.TotalAmount||void 0),n=r?t.context.cultureFormatter.formatCurrency(r):t.context.cultureFormatter.formatCurrency(t.resources.emptyPrice);return u().createElement("div",{className:"ms-cart-icon__subTotalText"},u().createElement("span",{className:"ms-cart-icon__subTotalPriceText"},t.resources.totalPriceFormatString,u().createElement("span",{className:"ms-cart-icon__subTotalPrice"},n)))})(this.props),u().createElement("p",{className:"ms-cart-icon__subtotal-message"},this.props.resources.subTotalMessage),this.props.checkoutAsSignInUserButton,this.props.checkoutAsGuestButton,null!==(i=this.props.data.cart.result)&&void 0!==i&&i.isEmpty?null:this.props.goToCartButton,u().createElement(o.Node,{className:"ms-cart-icon__btn-section"},null!==(s=this.props.data.cart.result)&&void 0!==s&&s.isEmpty?u().createElement(o.Button,{className:"ms-cart-icon__btn-backtoshopping",href:(0,n.getUrlSync)("home",this.props.context.actionContext)},this.props.resources.continueShoppingButtonTitle):null))))}}const p=d}},t=>{t.O(0,[0,3,2,4,5,6,7,8,9,10,11,20],(()=>{return e=1638,t(t.s=e);var e}));t.O()}]);
//# sourceMappingURL=1f359ef7b12048a00c03.bundle.js.map