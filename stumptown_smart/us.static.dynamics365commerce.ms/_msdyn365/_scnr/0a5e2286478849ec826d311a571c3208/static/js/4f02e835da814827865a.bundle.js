/*! For license information please see 4f02e835da814827865a.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkMsdyn365_Commerce_Online=self.webpackChunkMsdyn365_Commerce_Online||[]).push([[120],{0:e=>{e.exports=React},11:e=>{e.exports=ReactDOM},84:(e,t,s)=>{s.d(t,{$J:()=>C,Sl:()=>E,BE:()=>P,BU:()=>O,yQ:()=>D,TF:()=>v,Ml:()=>_,Gw:()=>y});var r=s(14),n=(s(70),s(63),s(67));class o{constructor(e){if(e=e||{},this.ContactPersonId=e.ContactPersonId,this.PersonId=e.PersonId,this.BusinessPartnerId=e.BusinessPartnerId,this.FirstName=e.FirstName,this.LastName=e.LastName,this.Email=e.Email,this.SpendingLimit=e.SpendingLimit?parseFloat(e.SpendingLimit):0,this.IsAdmin=e.IsAdmin,this.AccountNumber=e.AccountNumber,this.B2BUserId=e.B2BUserId,this.ExtensionProperties=void 0,e.ExtensionProperties){this.ExtensionProperties=[];for(var t=0;t<e.ExtensionProperties.length;t++)if(e.ExtensionProperties[t])if(e.ExtensionProperties[t]["@odata.type"]){var s=e.ExtensionProperties[t]["@odata.type"];s=s.substr(s.lastIndexOf(".")+1).concat("Class"),n[s]&&(this.ExtensionProperties[t]=new n[s](e.ExtensionProperties[t]))}else this.ExtensionProperties[t]=new n.CommercePropertyClass(e.ExtensionProperties[t]);else this.ExtensionProperties[t]=void 0}}}class a{constructor(e){if(e=e||{},this.Name=e.Name,this.AccountNumber=e.AccountNumber,this.ContactPersonID=e.ContactPersonID,this.IsSelected=e.IsSelected,this.ExtensionProperties=void 0,e.ExtensionProperties){this.ExtensionProperties=[];for(var t=0;t<e.ExtensionProperties.length;t++)if(e.ExtensionProperties[t])if(e.ExtensionProperties[t]["@odata.type"]){var s=e.ExtensionProperties[t]["@odata.type"];s=s.substr(s.lastIndexOf(".")+1).concat("Class"),n[s]&&(this.ExtensionProperties[t]=new n[s](e.ExtensionProperties[t]))}else this.ExtensionProperties[t]=new n.CommercePropertyClass(e.ExtensionProperties[t]);else this.ExtensionProperties[t]=void 0}}}class i{constructor(e){if(e=e||{},this.BusinessPartnerId=e.BusinessPartnerId,this.B2BUserId=e.B2BUserId,this.IsB2BAdmin=e.IsB2BAdmin,this.ContactPersonID=e.ContactPersonID,this.FirstName=e.FirstName,this.LastName=e.LastName,this.AccountNumber=e.AccountNumber,this.Email=e.Email,this.Phone=e.Phone,this.VatNumber=e.VatNumber,this.ExtensionProperties=void 0,e.ExtensionProperties){this.ExtensionProperties=[];for(var t=0;t<e.ExtensionProperties.length;t++)if(e.ExtensionProperties[t])if(e.ExtensionProperties[t]["@odata.type"]){var s=e.ExtensionProperties[t]["@odata.type"];s=s.substr(s.lastIndexOf(".")+1).concat("Class"),n[s]&&(this.ExtensionProperties[t]=new n[s](e.ExtensionProperties[t]))}else this.ExtensionProperties[t]=new n.CommercePropertyClass(e.ExtensionProperties[t]);else this.ExtensionProperties[t]=void 0}}}class c{constructor(e){e=e||{},this.Success=e.Success}}class l{constructor(e){e=e||{},this.Success=e.Success}}class u{constructor(e){e=e||{},this.Success=e.Success}}class d{constructor(e){e=e||{},this.Message=e.Message}}class p{constructor(e){e=e||{},this.Total=e.Total,this.ChargeOverriden=e.ChargeOverriden}}class h{constructor(e){if(e=e||{},null===e.UserInfo)this.UserInfo=void 0;else if(null==e.UserInfo["@odata.type"])this.UserInfo=new i(e.UserInfo);else{var t=e.UserInfo["@odata.type"];t=t.substr(t.lastIndexOf(".")+1).concat("Class"),n[t]&&(this.UserInfo=new n[t](e.UserInfo))}}}function m(e){const t=(new r.DataServiceQuery).resultSettings(e);return t.createDataServiceRequestForOperation("GetContacts",!1,o,"true",{bypassCache:"get",returnEntity:"DataServiceEntities.IContactEntity"},{})}function E(e){const t=m(e.queryResultSettings||{});return(0,r.callActionOrExecute)(t,e.callerContext)}function f(e,t,s,n){const o=new r.DataServiceQuery;return o.createDataServiceRequestForOperation("CreateContact",!1,c,"false",{bypassCache:"get",returnEntity:"DataServiceEntities.ICreateContactResponse"},{accountNum:e,firstName:t,lastName:s,email:n})}function C(e,t,s,n,o){const a=f(t,s,n,o);return(0,r.callActionOrExecute)(a,e.callerContext)}function b(e,t,s,n){const o=new r.DataServiceQuery;return o.createDataServiceRequestForOperation("UpdateContact",!1,l,"false",{bypassCache:"get",returnEntity:"DataServiceEntities.IUpdateContactResponse"},{contactPersonId:e,personId:t,firstName:s,lastName:n})}function y(e,t,s,n,o){const a=b(t,s,n,o);return(0,r.callActionOrExecute)(a,e.callerContext)}function x(e,t){const s=new r.DataServiceQuery;return s.createDataServiceRequestForOperation("RemoveContact",!1,u,"false",{bypassCache:"get",returnEntity:"DataServiceEntities.IRemoveContactResponse"},{contactPersonId:e,personId:t})}function v(e,t,s){const n=x(t,s);return(0,r.callActionOrExecute)(n,e.callerContext)}function g(e){const t=(new r.DataServiceQuery).resultSettings(e);return t.createDataServiceRequestForOperation("GetEligibleCustomers",!1,a,"true",{bypassCache:"get",returnEntity:"DataServiceEntities.IEligibleCustomerEntity"},{})}function P(e){const t=g(e.queryResultSettings||{});return(0,r.callActionOrExecute)(t,e.callerContext)}function w(e,t,s){const n=new r.DataServiceQuery;return n.createDataServiceRequestForOperation("SaveSessionCustomer",!1,d,"false",{bypassCache:"get",returnEntity:"DataServiceEntities.ISaveSessionCustomerResponse"},{accountNum:e,contactPersonId:t,cartId:s})}function _(e,t,s,n){const o=w(t,s,n);return(0,r.callActionOrExecute)(o,e.callerContext)}function I(e,t){const s=new r.DataServiceQuery;return s.createDataServiceRequestForOperation("GetEligibleCustomersTotal",!1,p,"false",{bypassCache:"get",returnEntity:"DataServiceEntities.IGetEligibleCustomersTotalResponse"},{cartId:e,checkoutCartId:t})}function O(e,t,s){const n=I(t,s);return(0,r.callActionOrExecute)(n,e.callerContext)}function S(){const e=new r.DataServiceQuery;return e.createDataServiceRequestForOperation("GetUserInfo",!1,h,"false",{bypassCache:"get",returnEntity:"DataServiceEntities.IGetUserInfoResponse"},{})}function D(e){const t=S();return(0,r.callActionOrExecute)(t,e.callerContext)}},272:(e,t,s)=>{s.d(t,{Xl:()=>u,yQ:()=>c});var r=s(14),n=s(67);class o{constructor(e){if(e=e||{},null===e.UserInfo)this.UserInfo=void 0;else if(null==e.UserInfo["@odata.type"])this.UserInfo=new a(e.UserInfo);else{var t=e.UserInfo["@odata.type"];t=t.substr(t.lastIndexOf(".")+1).concat("Class"),n[t]&&(this.UserInfo=new n[t](e.UserInfo))}}}class a{constructor(e){if(e=e||{},this.BusinessPartnerId=e.BusinessPartnerId,this.B2BUserId=e.B2BUserId,this.IsB2BAdmin=e.IsB2BAdmin,this.ContactPersonID=e.ContactPersonID,this.FirstName=e.FirstName,this.LastName=e.LastName,this.Email=e.Email,this.ExtensionProperties=void 0,e.ExtensionProperties){this.ExtensionProperties=[];for(var t=0;t<e.ExtensionProperties.length;t++)if(e.ExtensionProperties[t])if(e.ExtensionProperties[t]["@odata.type"]){var s=e.ExtensionProperties[t]["@odata.type"];s=s.substr(s.lastIndexOf(".")+1).concat("Class"),n[s]&&(this.ExtensionProperties[t]=new n[s](e.ExtensionProperties[t]))}else this.ExtensionProperties[t]=new n.CommercePropertyClass(e.ExtensionProperties[t]);else this.ExtensionProperties[t]=void 0}}}function i(e){const t=new r.DataServiceQuery;return t.createDataServiceRequestForOperation("GetUserInfo",!1,o,"false",{bypassCache:"get",returnEntity:"DataServiceEntities.IGetUserInfoResponse"},{email:e})}function c(e,t){const s=i(t);return(0,r.callActionOrExecute)(s,e.callerContext)}function l(e,t){const s=new r.DataServiceQuery;return s.createDataServiceRequestForOperation("CheckData",!1,"","false",{bypassCache:"get",returnEntity:""},{id:e,schema:t})}function u(e,t,s){const n=l(t,s);return(0,r.callActionOrExecute)(n,e.callerContext)}},1691:(e,t,s)=>{var r=s(5);s(4);function n(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function o(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach((function(t){(0,r.A)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const a={modules:{},dataActions:{}},i=(e,t)=>{if(a.dataActions[e]=t,!a.dataActions[e].default)throw new Error("Data action path "+e+" does not have a default export");a.dataActions[e].default.prototype.RegistrationId=e,a.dataActions[e].default.prototype.id&&(a.dataActions[a.dataActions[e].default.prototype.id]=e)};a.modules["eve-sobo-checker"]={c:()=>s(1692),$type:"contentModule",da:[{name:"cart",path:"@msdyn365-commerce/global-state/dist/lib/data-actions/cart-state-data-action",runOn:0},{name:"total",path:"actions/get-customers-count",runOn:1}],iNM:!1,ns:"__local__",n:"eve-sobo-checker",p:"__local__",pdp:"",md:"src/modules/eve-sobo-checker"};{const e="@msdyn365-commerce/global-state/dist/lib/data-actions/cart-state-data-action";let t=s(56);i(e,t)}{const e="actions/get-customers-count";let t=s(1693);i(e,t)}window.__bindings__=window.__bindings__||{},window.__bindings__.modules=o(o({},window.__bindings__.modules||{}),a.modules),window.__bindings__.dataActions=o(o({},window.__bindings__.dataActions||{}),a.dataActions);const c={};c["__local__|__local__|modules|eve-sobo-checker|eve-sobo-checker"]={c:()=>s(1694),cn:"__local__-__local__-eve-sobo-checker"},window.__bindings__=window.__bindings__||{},window.__bindings__.viewDictionary=o(o({},window.__bindings__.viewDictionary||{}),c)},1692:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});s(4);var r=s(5),n=(s(7),s(10)),o=s(0),a=s(2),i=s(84),c=s(13),l=s(272);function u(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function d(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?u(Object(s),!0).forEach((function(t){(0,r.A)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):u(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class p extends o.PureComponent{constructor(e,t){super(e),this._loadCustomers=async()=>{const{context:{actionContext:e,telemetry:t},resources:{errorMessage:s}}=this.props;this.state.customersList.length||await(0,i.BE)({callerContext:e}).then((e=>{e&&e.length?this.setState({customersList:e}):this.setState({customersList:[],errorMessage:s}),this.setState({loaded:!0,showModal:!0})})).catch((e=>{t.trace(e),this.setState({loaded:!0})}))},this._closeModal=()=>{this.setState({showModal:!1})},this._selectCustomer=async e=>{if(!e.AccountNumber||!e.ContactPersonID)return;const{context:{request:t,actionContext:s,telemetry:r},resources:{errorMessage:n}}=this.props,o=t.cookies.getCartCookie();this.setState({errorMessage:""}),await(0,i.Ml)({callerContext:s},e.AccountNumber,e.ContactPersonID,(null==o?void 0:o.split(":")[1])||"").then((e=>{"Success"===(null==e?void 0:e.Message)||"Cart exists"===(null==e?void 0:e.Message)?window.location.reload():(console.log("error saving session customer"),this.setState({errorMessage:n}))})).catch((e=>{r.trace(e)}))},this._renderTable=()=>{const e=this.state.customersList;return e.length?o.createElement("table",null,o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",null,"Account Number"),o.createElement("th",null,"Name"),o.createElement("th",null))),o.createElement("tbody",null,e.map((e=>o.createElement("tr",null,o.createElement("td",null,e.AccountNumber),o.createElement("td",null,e.Name),o.createElement("td",null,e.IsSelected?o.createElement("div",{className:"btn-selected"},"Selected"):o.createElement("button",{type:"button",className:"btn-select",onClick:()=>this._selectCustomer(e)},"Select"))))))):o.createElement("p",null,this.props.resources.noUsersText)},this._renderLink=(e,t)=>{if(e>0){let e="/shop-as";if(a.default.isBrowser){const t=window.location.href.indexOf("/ocs")>1;t&&(e="/ocs"+e);const s=window.location.href.indexOf("/scr")>1;s&&(e="/scr"+e),document.referrer.indexOf("b2clogin.com")>-1&&-1===window.location.href.toLowerCase().indexOf("shop-as")&&this._loadCustomers()}return o.createElement("a",{href:e},t)}return o.createElement(o.Fragment,null)},this.state={customersList:[],errorMessage:"",loaded:!1,showModal:!1}}get cartNotEmpty(){var e;const{data:{cart:{result:t}}}=this.props;return!(null==t||null===(e=t.cart.CartLines)||void 0===e||!e.length)}render(){var e;a.default.isBrowser&&document.addEventListener("CHECK_DATA",(e=>{(0,l.Xl)({callerContext:this.props.context.actionContext},e.detail.id,e.detail.schema).catch((e=>{console.log(e)})).then((e=>{}))}));const t=(null===(e=this.props.data.total.result)||void 0===e?void 0:e.Total)||0,s=this.props.resources.shopAsLinkText,r=d(d({},this.props),{},{cartNotEmpty:this.cartNotEmpty,renderTable:this._renderTable(),renderLink:this._renderLink(t,s),showModal:this.state.showModal,closeModal:this._closeModal});return this.props.renderView(r)}}(0,n.Cg)([c.EW],p.prototype,"cartNotEmpty",null);const h=p},1693:(e,t,s)=>{s.r(t),s.d(t,{CustomersTotalInput:()=>a,createGetCustomersTotalInput:()=>i,default:()=>u,getCustomersTotal:()=>c,getCustomersTotalDataAction:()=>l});s(7);var r=s(6),n=s(2),o=s(84);class a{constructor(e){this.getCacheKey=()=>(0,r.buildCacheKey)("CustomersTotal",this.apiSettings),this.getCacheObjectType=()=>"CustomersTotal",this.dataCacheType=()=>"none",this.apiSettings=e}}const i=e=>{const{requestContext:t}=e;if(!t.user.isAuthenticated)throw new Error("User is not logged in.");return new a(t.apiSettings)};async function c(e,t){const s=t.requestContext.cookies.getCartCookie(),r=t.requestContext.cookies.getCheckoutCartCookie();return(0,o.BU)({callerContext:t},(null==s?void 0:s.split(":")[1])||"",(null==r?void 0:r.split(":")[1])||"").then((e=>e)).catch((e=>{throw t.telemetry.exception(e),t.trace("[get-customers-total] Unable to load customers total"),new Error("[get-customers-total] Unable to load customers total")}))}const l=(0,n.createObservableDataAction)({id:"get-customer-total",action:c,input:i}),u=l},1694:(e,t,s)=>{s.r(t),s.d(t,{default:()=>o});var r=s(0),n=s(1);const o=e=>{const{showModal:t,closeModal:s,renderLink:o,renderTable:a,cartNotEmpty:i,resources:{cartWarning:c,selectUserHeading:l}}=e;return r.createElement("div",{className:"container"},r.createElement("div",{className:"eve-sobo-checker"},o),r.createElement(n.Modal,{isOpen:t},r.createElement(n.ModalBody,null,r.createElement("h2",null,l),r.createElement("div",{className:"eve-sobo-wrapper"},i?c:a)),r.createElement(n.ModalFooter,null,r.createElement(n.Button,{className:"msc-order-template-name-dialog__dialog__cancel-button msc-btn msc-btn",onClick:s},"Close"))))}}},e=>{e.O(0,[0,3,2,4,5,6,7,8,9,13],(()=>{return t=1691,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=4f02e835da814827865a.bundle.js.map